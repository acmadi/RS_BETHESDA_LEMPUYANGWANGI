<?php$PID = "lap_pengadaan";$SC = $_SERVER["SCRIPT_NAME"];$ROWS_PER_PAGE = 20;require_once("startup.php");require_once("lib/dbconn.php");require_once("lib/form.php");require_once("lib/class.PgTable.php");require_once("lib/class.BaseTable.php");require_once("lib/functions.php");if ($_GET["edit"]=='view'){    title_print("Rincian Item Barang");    $supplier = getFromTable(               "select a.nama from rs00028 a, c_po b ".               "where  a.nama::text='".$_GET["g"]."' ");    $tanggal_po = getFromTable(               "select to_char(po_tanggal,'DD Mon YYYY') from c_po ".               "where po_id='".$_GET["po_id"]."' ");	$tanggal_po2 = getFromTable(               "select po_tanggal from c_po ".               "where po_id='".$_GET["po_id"]."' ");	$tanggung_jwb = getFromTable(               "select po_personal from c_po ".               "where po_id='".$_GET["po_id"]."' ");    $f = new Form("");	echo "<br>";echo "<table>";	echo "<tr>";		echo "<td bgcolor='B0C4DE'><b> NO. PO </td>";		echo "<td bgcolor='B0C4DE'><b>: ".$_GET["po_id"]." </td>";	echo "</tr>";	echo "<tr>";		echo "<td bgcolor='B0C4DE'><b> NAMA SUPPLIER</td>";		echo "<td bgcolor='B0C4DE'><b>: ".$_GET["supp"]." </td>";	echo "</tr>";	echo "<tr>";		echo "<td bgcolor='B0C4DE'><b> TANGGAL PO </td>";		echo "<td bgcolor='B0C4DE'><b>: $tanggal_po </td>";	echo "</tr>";	echo "<tr>";		echo "<td bgcolor='B0C4DE'><b> PENANGGUNG JAWAB</td>";		echo "<td bgcolor='B0C4DE'><b>: $tanggung_jwb </td>";	echo "</tr>";echo "</table>";    $f->execute();      if (!$GLOBALS['print']){    	//echo "<DIV ALIGN=RIGHT><A HREF='$SC?p=$PID'>".icon("back","Kembali")."</a></DIV>";    } else {    	"";    }        $r2 = pg_query($con,	      "select sum((harga_beli-(harga_beli*(diskon1/100))) * total_jumlah) as jml_tagihan from c_po_item where po_id='".$_GET["po_id"]."'");	$d2 = pg_fetch_object($r2);    pg_free_result($r2);	    echo "<br>";    $t = new PgTable($con, "100%");      	$t->SQL = "select a.obat,b.batch,to_char(b.expire,'dd Mon yyyy')as expire,b.item_qty,b.jumlah2,to_char(b.harga_beli,'999,999,999.99'),diskon1,diskon2,to_char((b.harga_beli-diskon2) * b.total_jumlah,'999,999,999.99') 	from c_po_item b, rs00015 a 	where b.po_id='".$_GET["po_id"]."' and a.id::text=b.item_id";    $t->ColHeader = array("NAMA OBAT", "BATCH ID","EXPIRE DATE","QTY","ISI SATUAN TERKECIL","HARGA","DISKON (%)","DISKON (Rp.)","JUMLAH HARGA");    $t->ColAlign = array("LEFT","LEFT","CENTER","CENTER","CENTER","RIGHT","RIGHT","CENTER","RIGHT","RIGHT");    $t->setlocale("id_ID");    $t->ShowRowNumber = true;    $t->RowsPerPage = $ROWS_PER_PAGE;	$t->ColFooter [7]=  number_format($d2->jml_tagihan,2,',','.');    $t->execute();}else if ($_GET["edit"]=='delete'){//$data = getFromTable("select tdesc from rs00001 where tt='".$_GET[tt]."' and tc='".$_GET[tc]."'");    echo "<div align=center>";    echo "<form action='actions/po.delete.php' method='get'>";    echo "<font color=red size=3>PERINGATAN !</font><br>";    echo "<font class=SUB_MENU> Pesanan dari Supplier $_GET[supp] dengan Nomor PO <font color=navy>'".$_GET[po_id]."'</font> akan Dihapus.</font><br><br>";    echo "<input type=hidden name=p value=$PID>";    echo "<input type=hidden name=po_id value=".$_GET[po_id].">";    echo "<input type=hidden name=supp value=".$_GET[supp].">";        echo "<input type=submit name=sure value='YA'>&nbsp;";    echo "<input type=submit name=sure value='TIDAK'>";    echo "</form>";    echo "</div>";}else{title_print("<img src='icon/rawat-jalan-2_asli.gif' align='absmiddle' > LAPORAN PENGADAAN BARANG");title_excel("lap_pengadaan&tanggal1D=".$_GET["tanggal1D"]."&tanggal1M=".$_GET["tanggal1M"]."&tanggal1Y=".$_GET["tanggal1Y"]."&tanggal2D=".$_GET["tanggal2D"]."&tanggal2M=".$_GET["tanggal2M"]."&tanggal2Y=".$_GET["tanggal2Y"]."&supplier=".$_GET["supp"]."&faktur_po=".$_GET["po_id"]."");    $ext = "OnChange = 'Form1.submit();'";    $f = new Form($SC, "GET", "NAME=Form1");    $f->PgConn = $con;    $f->hidden("p", $PID);	if (!$GLOBALS['print']) {		include(xxx2);		$f->selectSQL("supplier","SUPPLIER","SELECT '' AS id, '' AS nama UNION SELECT id, nama FROM rs00028 ORDER BY nama ASC", $_GET['supplier'],null);		$f->text("faktur_po", "No. PO / No. Faktur", null, 50, $_GET['faktur_po']);		$f->submit ("TAMPILKAN");		$f->execute();	}	else{		include(xxx2);		$f->selectSQL("supplier","SUPPLIER","SELECT '' AS id, '' AS nama UNION SELECT id, nama FROM rs00028 ORDER BY nama ASC", $_GET['supplier'],null);		$f->text("faktur_po", "No. PO / No. Faktur", null, 50, $_GET['faktur_po']);		$f->execute();	}    echo "<BR>";	$tgl1=$ts_check_in1;	$tgl2=$ts_check_in2;    $t = new PgTable($con, "100%");     if($_GET['supplier']){		$cond = " AND supp_id=".$_GET['supplier'];	}else if($_GET['faktur_po']){		$cond = " AND (po_id LIKE '%".$_GET['faktur_po']."%' )";	}else if($_GET['faktur_po'] && $_GET['supplier']){	$cond = " AND supp_id=".$_GET['supplier']." AND (po_id LIKE '%".$_GET['faktur_po']."%' )";	}else{}		    $t->SQL = "	select po_id,				to_char(po_tanggal,'DD Mon YYYY'),				nama,				po_personal,				to_char((SELECT SUM((harga_beli-(harga_beli*(diskon1/100)))*total_jumlah) FROM c_po_item WHERE po_id = rsv_pengadaan.po_id),'999,999,999.99') AS total ,				po_id,				id from rsv_pengadaan 				where po_tanggal between '$tgl1' and '$tgl2'".$cond;    $t->setlocale("id_ID");    $t->ColHeader = array("NO. PO","TANGGAL", "NAMA SUPPLIER" , "PENANGGUNG JAWAB","TOTAL","VIEW <BR> DETAIL","PRINT <BR> KWITANSI");    $t->ShowRowNumber = true;    $t->ColAlign = array("left","center","left","left","right","center","center");    $t->RowsPerPage = $ROWS_PER_PAGE;    $jml = getFromTable("select SUM((SELECT SUM((harga_beli-(harga_beli*(diskon1/100)))*total_jumlah) FROM c_po_item WHERE po_id = rsv_pengadaan.po_id))						AS total from rsv_pengadaan where po_tanggal between '$tgl1' and '$tgl2'".$cond);            $t->ColFooter [4]=  number_format($jml,2,',','.');    $t->ColFormatHtml[6] = "<A CLASS=TBL_HREF HREF='index2.php?p=print_po&po_id=<#5#>&jenis=<#6#>&e=lap'>".icon("print","Print Kwitansi")."</A>";    $t->ColFormatHtml[5] = "<A CLASS=TBL_HREF HREF='index2.php?p=$PID&edit=view&po_id=<#5#>&supp=<#2#>'>".icon("view","Print Kwitansi").							"</A>&nbsp;&nbsp<A CLASS=TBL_HREF HREF='index2.php?p=$PID&edit=delete&po_id=<#5#>&supp=<#2#>'>".icon("delete","Delete")."</A>";	$t->execute();}?>